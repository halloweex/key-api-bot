import{r as s,d as v,e as P,j as e,f as m,B as w}from"./index-BL1dFcbn.js";import{C as S,a as R,R as E,P as L,g as N,d as T,T as B,c as O,L as h}from"./ChartContainer-MKzQ0Ycl.js";import{C as c}from"./colors-CU0AFKqM.js";import{P as _,a as D}from"./PieChart-DIc3lDKF.js";import{C as A}from"./tooltipContext-nfTICcRa.js";import{L as I}from"./Legend-DvbsusDj.js";const Y=s.memo(function(){const[r,i]=s.useState(null),{data:n,isLoading:g,error:u,refetch:C}=v(),{data:l,isLoading:p}=P(r),d=r?p:g,x=u,o=s.useMemo(()=>r&&l?.labels?.length?l.labels.map((a,t)=>({name:a||"Unknown",value:l.revenue?.[t]??0,color:c[t%c.length]})):n?.categoryBreakdown?.labels?.length?n.categoryBreakdown.labels.map((a,t)=>({name:a||"Unknown",value:n.categoryBreakdown.revenue?.[t]??0,color:c[t%c.length]})):[],[n,l,r]),y=s.useMemo(()=>o.reduce((a,t)=>a+t.value,0),[o]),f=s.useCallback(a=>{i(t=>t?null:a.name)},[]),b=s.useCallback(()=>{i(null)},[]),k=r?`${r} - Subcategories`:"Sales by Category",j=!d&&o.length===0;return e.jsxs(S,{title:k,isLoading:d,error:x,onRetry:C,isEmpty:j,height:"lg",ariaLabel:`Pie chart showing ${r?"subcategory":"category"} sales breakdown`,action:r&&e.jsx(w,{size:"sm",variant:"ghost",onClick:b,children:"â† Back"}),children:[e.jsx("div",{style:{height:R.height.lg},children:e.jsx(E,{width:"100%",height:"100%",children:e.jsxs(_,{children:[e.jsx(D,{data:o,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",nameKey:"name",onClick:f,style:{cursor:"pointer"},label:({percent:a})=>N(a??0),...L,children:o.map((a,t)=>e.jsx(A,{fill:a.color,stroke:T.background,strokeWidth:2},`cell-${t}`))}),e.jsx(B,{contentStyle:O,formatter:(a,t)=>[m(Number(a)||0),String(t)]}),e.jsx(I,{...h,wrapperStyle:{...h.wrapperStyle,fontSize:"12px"},layout:"vertical",align:"right",verticalAlign:"middle"})]})})}),e.jsx("div",{className:"mt-2 text-center",children:e.jsx("p",{className:"text-xs text-slate-500",children:r?"Click chart to go back to categories":"Click a category to see subcategories"})}),e.jsx("div",{className:"mt-2 pt-3 border-t border-slate-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"Total Revenue"}),e.jsx("span",{className:"text-white font-semibold",children:m(y)})]})})]})});export{Y as CategoryChart};
