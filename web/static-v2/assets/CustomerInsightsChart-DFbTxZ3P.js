import{r as l,g as R,j as e,c,f as u,h as b,C as S,i as P}from"./index-BL1dFcbn.js";import{C as N,a as n,R as x,P as O,T as g,c as C,G as y,X as w,f as I,Y as T,e as _}from"./ChartContainer-MKzQ0Ycl.js";import{a as h}from"./colors-CU0AFKqM.js";import{P as A,a as L}from"./PieChart-DIc3lDKF.js";import{C as E}from"./tooltipContext-nfTICcRa.js";import{L as V,a as M}from"./LineChart-D7QijRQe.js";import{C as X,X as K,Y}from"./CartesianChart-DBaW1knG.js";const o=l.memo(function({label:s,value:i,colorClass:m}){return e.jsx(S,{className:"bg-slate-700/50",children:e.jsxs(P,{className:"py-2 px-3",children:[e.jsx("p",{className:"text-xs text-slate-400",children:s}),e.jsx("p",{className:`text-lg font-semibold ${m}`,children:i})]})})}),U=l.memo(function(){const{data:s,isLoading:i,error:m,refetch:f}=R(),d=l.useMemo(()=>s?.newVsReturning?.labels?.length?s.newVsReturning.labels.map((t,a)=>({name:t,value:s.newVsReturning.data?.[a]??0,color:s.newVsReturning.backgroundColor?.[a]??(a===0?h.new:h.returning)})):[],[s]),p=l.useMemo(()=>s?.aovTrend?.labels?.length?s.aovTrend.labels.map((t,a)=>({date:t,aov:s.aovTrend.data?.[a]??0})):[],[s]),r=s?.metrics,v=!i&&d.length===0;return e.jsxs(N,{title:"Customer Insights",isLoading:i,error:m,onRetry:f,isEmpty:v,height:"sm",ariaLabel:"Charts showing customer segmentation and average order value trends",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 mb-2",children:"New vs Returning"}),e.jsx("div",{style:{height:n.height.sm},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(A,{children:[e.jsx(L,{data:d,cx:"50%",cy:"50%",innerRadius:40,outerRadius:70,dataKey:"value",nameKey:"name",label:({name:t,percent:a})=>`${t}: ${((a??0)*100).toFixed(0)}%`,...O,children:d.map((t,a)=>e.jsx(E,{fill:t.color},`cell-${a}`))}),e.jsx(g,{contentStyle:C,formatter:t=>[c(Number(t)||0),"Customers"]})]})})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 mb-2",children:"Average Order Value Trend"}),e.jsx("div",{style:{height:n.height.sm},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(V,{data:p,margin:n.margin.default,children:[e.jsx(X,{...y}),e.jsx(K,{dataKey:"date",...w,fontSize:n.fontSize.xs}),e.jsx(Y,{...T,fontSize:n.fontSize.xs,tickFormatter:I}),e.jsx(g,{contentStyle:C,formatter:t=>[u(Number(t)||0),"AOV"]}),e.jsx(M,{type:"monotone",dataKey:"aov",stroke:h.new,..._})]})})})]})]}),r&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mt-4 pt-4 border-t border-slate-700",children:[e.jsx(o,{label:"New Customers",value:c(r.newCustomers??0),colorClass:"text-blue-400"}),e.jsx(o,{label:"Returning",value:c(r.returningCustomers??0),colorClass:"text-purple-400"}),e.jsx(o,{label:"Repeat Rate",value:b(r.repeatRate??0),colorClass:"text-green-400"}),e.jsx(o,{label:"Avg Order Value",value:u(r.averageOrderValue??0),colorClass:"text-orange-400"})]})]})});export{U as CustomerInsightsChart};
